{"version":3,"sources":["../../../../src/app/signup/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport type { UserRole } from \"@/context/AuthContext\";\n\ntype SignupResponse = {\n  message?: string;\n};\n\ntype LoginResponse = {\n  token: string;\n  message?: string;\n};\n\ntype MeResponse = {\n  user: {\n    role: UserRole;\n  };\n};\n\nasync function getRoleFromToken(token: string): Promise<UserRole> {\n  const meResponse = await fetch(\"/api/auth/me\", {\n    headers: {\n      Authorization: `Bearer ${token}`,\n    },\n  });\n\n  if (!meResponse.ok) {\n    throw new Error(\"Unable to resolve user role\");\n  }\n\n  const meData = (await meResponse.json()) as MeResponse;\n  if (\n    meData.user.role !== \"CUSTOMER\" &&\n    meData.user.role !== \"VENDOR\" &&\n    meData.user.role !== \"ADMIN\"\n  ) {\n    throw new Error(\"Invalid user role\");\n  }\n\n  return meData.user.role;\n}\n\nexport default function SignupPage() {\n  const router = useRouter();\n  const { login } = useAuth();\n  const [name, setName] = useState(\"\");\n  const [email, setEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [role, setRole] = useState<UserRole>(\"CUSTOMER\");\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  async function handleSubmit(event: React.FormEvent<HTMLFormElement>) {\n    event.preventDefault();\n    setLoading(true);\n    setError(null);\n\n    try {\n      const signupResponse = await fetch(\"/api/auth/signup\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          name: name.trim(),\n          email,\n          password,\n          role,\n        }),\n      });\n\n      const signupData = (await signupResponse.json()) as SignupResponse;\n      if (!signupResponse.ok) {\n        throw new Error(signupData.message ?? \"Unable to sign up. Please try again.\");\n      }\n\n      const loginResponse = await fetch(\"/api/auth/login\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({ email, password }),\n      });\n\n      const loginData = (await loginResponse.json()) as LoginResponse;\n      if (!loginResponse.ok || !loginData.token) {\n        throw new Error(loginData.message ?? \"Account created, but auto login failed.\");\n      }\n\n      const resolvedRole = await getRoleFromToken(loginData.token);\n      login(loginData.token, resolvedRole);\n\n      if (resolvedRole === \"VENDOR\") {\n        router.replace(\"/vendor\");\n      } else {\n        router.replace(\"/\");\n      }\n    } catch (err) {\n      const message =\n        err instanceof Error ? err.message : \"Unable to sign up. Please try again.\";\n      setError(message);\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  return (\n    <div className=\"min-h-screen bg-black px-6 py-16\">\n      <div className=\"mx-auto max-w-7xl\">\n        <div className=\"mx-auto max-w-xl text-center\">\n          <h1 className=\"text-5xl font-bold tracking-tight text-white md:text-6xl\">Get Started</h1>\n          <p className=\"mt-3 text-xl text-zinc-400 md:text-2xl\">Create your Localli account</p>\n        </div>\n\n        <div className=\"mx-auto mt-10 w-full max-w-[560px] rounded-3xl border border-zinc-800 bg-zinc-900/90 p-8 md:p-10\">\n          <form className=\"space-y-6\" onSubmit={handleSubmit}>\n            <div>\n              <label className=\"mb-2 block text-sm font-medium text-zinc-400\" htmlFor=\"name\">\n                Full Name\n              </label>\n              <input\n                className=\"w-full rounded-xl border border-zinc-800 bg-black px-5 py-4 text-2xl text-white outline-none ring-[#4F7CFF] placeholder:text-zinc-500 focus:ring-2\"\n                id=\"name\"\n                onChange={(event) => setName(event.target.value)}\n                placeholder=\"John Doe\"\n                required\n                type=\"text\"\n                value={name}\n              />\n            </div>\n\n            <div>\n              <label className=\"mb-2 block text-sm font-medium text-zinc-400\" htmlFor=\"email\">\n                Email\n              </label>\n              <input\n                className=\"w-full rounded-xl border border-zinc-800 bg-black px-5 py-4 text-2xl text-white outline-none ring-[#4F7CFF] placeholder:text-zinc-500 focus:ring-2\"\n                id=\"email\"\n                onChange={(event) => setEmail(event.target.value)}\n                placeholder=\"you@example.com\"\n                required\n                type=\"email\"\n                value={email}\n              />\n            </div>\n\n            <div>\n              <label className=\"mb-2 block text-sm font-medium text-zinc-400\" htmlFor=\"password\">\n                Password\n              </label>\n              <input\n                className=\"w-full rounded-xl border border-zinc-800 bg-black px-5 py-4 text-2xl text-white outline-none ring-[#4F7CFF] placeholder:text-zinc-500 focus:ring-2\"\n                id=\"password\"\n                minLength={6}\n                onChange={(event) => setPassword(event.target.value)}\n                required\n                type=\"password\"\n                value={password}\n              />\n            </div>\n\n            <div>\n              <label className=\"mb-2 block text-sm font-medium text-zinc-400\" htmlFor=\"role\">\n                I want to\n              </label>\n              <select\n                className=\"w-full rounded-xl border border-zinc-800 bg-black px-5 py-4 text-2xl text-white outline-none ring-[#4F7CFF] focus:ring-2\"\n                id=\"role\"\n                onChange={(event) => setRole(event.target.value as UserRole)}\n                value={role}\n              >\n                <option value=\"CUSTOMER\">Shop locally</option>\n                <option value=\"VENDOR\">Sell as a vendor</option>\n              </select>\n            </div>\n\n            {error ? <p className=\"text-lg text-[#FF453A]\">{error}</p> : null}\n\n            <button\n              className=\"w-full rounded-xl bg-[#4F7CFF] px-5 py-4 text-3xl font-semibold text-white transition hover:bg-[#3f6ef2] disabled:cursor-not-allowed disabled:opacity-60\"\n              disabled={loading}\n              type=\"submit\"\n            >\n              {loading ? \"Creating account...\" : \"Create Account\"}\n            </button>\n          </form>\n\n          <p className=\"mt-6 text-center text-lg text-zinc-400\">\n            Already have an account?{\" \"}\n            <a className=\"text-[#4F7CFF] transition hover:text-[#6A8CFF]\" href=\"/login\">\n              Sign in\n            </a>\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"uDAEA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAkBA,eAAe,EAAiB,CAAa,EAC3C,IAAM,EAAa,MAAM,MAAM,eAAgB,CAC7C,QAAS,CACP,cAAe,CAAC,OAAO,EAAE,EAAA,CAAO,AAClC,CACF,GAEA,GAAI,CAAC,EAAW,EAAE,CAChB,CADkB,KACZ,AAAI,MAAM,+BAGlB,IAAM,EAAU,MAAM,EAAW,IAAI,GACrC,GACuB,aAArB,EAAO,IAAI,CAAC,IAAI,EACK,WAArB,EAAO,IAAI,CAAC,IAAI,EACK,AAArB,SACA,GADO,IAAI,CAAC,IAAI,CAEhB,MAAM,AAAI,MAAM,qBAGlB,OAAO,EAAO,IAAI,CAAC,IAAI,AACzB,CAEe,SAAS,IACtB,IAAM,EAAS,CAAA,EAAA,EAAA,SAAS,AAAT,IACT,OAAE,CAAK,CAAE,CAAG,CAAA,EAAA,EAAA,OAAA,AAAO,IACnB,CAAC,EAAM,EAAQ,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IAC3B,CAAC,EAAO,EAAS,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IAC7B,CAAC,EAAU,EAAY,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IACnC,CAAC,EAAM,EAAQ,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAW,YACrC,CAAC,EAAS,EAAW,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GACjC,CAAC,EAAO,EAAS,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAgB,MAElD,eAAe,EAAa,CAAuC,EACjE,EAAM,cAAc,GACpB,GAAW,GACX,EAAS,MAET,GAAI,CACF,IAAM,EAAiB,MAAM,MAAM,mBAAoB,CACrD,OAAQ,OACR,QAAS,CACP,eAAgB,kBAClB,EACA,KAAM,KAAK,SAAS,CAAC,CACnB,KAAM,EAAK,IAAI,GACf,iBACA,OACA,CACF,EACF,GAEM,EAAc,MAAM,EAAe,IAAI,GAC7C,GAAI,CAAC,EAAe,EAAE,CACpB,CADsB,KAChB,AAAI,MAAM,EAAW,OAAO,EAAI,wCAGxC,IAAM,EAAgB,MAAM,MAAM,kBAAmB,CACnD,OAAQ,OACR,QAAS,CACP,eAAgB,kBAClB,EACA,KAAM,KAAK,SAAS,CAAC,OAAE,WAAO,CAAS,EACzC,GAEM,EAAa,MAAM,EAAc,IAAI,GAC3C,GAAI,CAAC,EAAc,EAAE,EAAI,CAAC,EAAU,KAAK,CACvC,CADyC,KAC/B,AAAJ,MAAU,EAAU,OAAO,EAAI,2CAGvC,IAAM,EAAe,MAAM,EAAiB,EAAU,KAAK,EAC3D,EAAM,EAAU,KAAK,CAAE,GAEF,UAAU,CAA3B,EACF,EAAO,OAAO,CAAC,WAEf,EAAO,OAAO,CAAC,IAEnB,CAAE,MAAO,EAAK,CAGZ,EADE,OACO,MADQ,MAAQ,EAAI,OAAO,CAAG,uCAEzC,QAAU,CACR,GAAW,EACb,CACF,CAEA,MACE,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,4CACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,8BACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,yCACb,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,oEAA2D,gBACzE,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,kDAAyC,mCAGxD,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,6GACb,CAAA,EAAA,EAAA,IAAA,EAAC,OAAA,CAAK,UAAU,YAAY,SAAU,YACpC,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CAAM,UAAU,+CAA+C,QAAQ,gBAAO,cAG/E,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CACC,UAAU,qJACV,GAAG,OACH,SAAU,AAAC,GAAU,EAAQ,EAAM,MAAM,CAAC,KAAK,EAC/C,YAAY,WACZ,QAAQ,CAAA,CAAA,EACR,KAAK,OACL,MAAO,OAIX,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CAAM,UAAU,+CAA+C,QAAQ,iBAAQ,UAGhF,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CACC,UAAU,qJACV,GAAG,QACH,SAAU,AAAC,GAAU,EAAS,EAAM,MAAM,CAAC,KAAK,EAChD,YAAY,kBACZ,QAAQ,CAAA,CAAA,EACR,KAAK,QACL,MAAO,OAIX,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CAAM,UAAU,+CAA+C,QAAQ,oBAAW,aAGnF,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CACC,UAAU,qJACV,GAAG,WACH,UAAW,EACX,SAAU,AAAC,GAAU,EAAY,EAAM,MAAM,CAAC,KAAK,EACnD,QAAQ,CAAA,CAAA,EACR,KAAK,WACL,MAAO,OAIX,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CAAM,UAAU,+CAA+C,QAAQ,gBAAO,cAG/E,CAAA,EAAA,EAAA,IAAA,EAAC,SAAA,CACC,UAAU,2HACV,GAAG,OACH,SAAW,AAAD,GAAW,EAAQ,EAAM,MAAM,CAAC,KAAK,EAC/C,MAAO,YAEP,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAAO,MAAM,oBAAW,iBACzB,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAAO,MAAM,kBAAS,2BAI1B,EAAQ,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,kCAA0B,IAAa,KAE7D,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CACC,UAAU,2JACV,SAAU,EACV,KAAK,kBAEJ,EAAU,sBAAwB,sBAIvC,CAAA,EAAA,EAAA,IAAA,EAAC,IAAA,CAAE,UAAU,mDAAyC,2BAC3B,IACzB,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,iDAAiD,KAAK,kBAAS,sBAQxF"}