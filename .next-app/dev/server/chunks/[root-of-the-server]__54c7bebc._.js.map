{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Ribhav/OneDrive/Documents/Projects/Major%20project%20final/localli/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\r\n\r\nconst globalForPrisma = global as unknown as { prisma: PrismaClient };\r\n\r\nexport const prisma =\r\n  globalForPrisma.prisma ||\r\n  new PrismaClient({\r\n    log: [\"query\"],\r\n  });\r\n\r\nif (process.env.NODE_ENV !== \"production\")\r\n  globalForPrisma.prisma = prisma;\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AAEC,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,sMAAY,CAAC;IACf,KAAK;QAAC;KAAQ;AAChB;AAEF,wCACE,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 63, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Ribhav/OneDrive/Documents/Projects/Major%20project%20final/localli/src/lib/geo.ts"],"sourcesContent":["const EARTH_RADIUS_KM = 6371;\n\nfunction toRadians(value: number) {\n  return (value * Math.PI) / 180;\n}\n\nexport function distanceKm(lat1: number, lng1: number, lat2: number, lng2: number) {\n  const dLat = toRadians(lat2 - lat1);\n  const dLng = toRadians(lng2 - lng1);\n  const a =\n    Math.sin(dLat / 2) ** 2 +\n    Math.cos(toRadians(lat1)) * Math.cos(toRadians(lat2)) * Math.sin(dLng / 2) ** 2;\n\n  return EARTH_RADIUS_KM * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n}\n\n"],"names":[],"mappings":";;;;AAAA,MAAM,kBAAkB;AAExB,SAAS,UAAU,KAAa;IAC9B,OAAO,AAAC,QAAQ,KAAK,EAAE,GAAI;AAC7B;AAEO,SAAS,WAAW,IAAY,EAAE,IAAY,EAAE,IAAY,EAAE,IAAY;IAC/E,MAAM,OAAO,UAAU,OAAO;IAC9B,MAAM,OAAO,UAAU,OAAO;IAC9B,MAAM,IACJ,KAAK,GAAG,CAAC,OAAO,MAAM,IACtB,KAAK,GAAG,CAAC,UAAU,SAAS,KAAK,GAAG,CAAC,UAAU,SAAS,KAAK,GAAG,CAAC,OAAO,MAAM;IAEhF,OAAO,kBAAkB,IAAI,KAAK,KAAK,CAAC,KAAK,IAAI,CAAC,IAAI,KAAK,IAAI,CAAC,IAAI;AACtE"}},
    {"offset": {"line": 81, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Ribhav/OneDrive/Documents/Projects/Major%20project%20final/localli/src/app/api/products/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { prisma } from \"@/lib/prisma\";\nimport { distanceKm } from \"@/lib/geo\";\n\nexport async function GET(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url);\n\n    const query = searchParams.get(\"query\")?.trim();\n    const storeId = searchParams.get(\"storeId\");\n    const minPrice = searchParams.get(\"minPrice\");\n    const maxPrice = searchParams.get(\"maxPrice\");\n    const latParam = searchParams.get(\"lat\");\n    const lngParam = searchParams.get(\"lng\");\n    const radiusKmParam = searchParams.get(\"radiusKm\");\n\n    const lat = latParam ? Number(latParam) : NaN;\n    const lng = lngParam ? Number(lngParam) : NaN;\n    const radiusKm = radiusKmParam ? Number(radiusKmParam) : 10;\n\n    const products = await prisma.product.findMany({\n      where: {\n        ...(query\n          ? {\n              name: {\n                contains: query,\n                mode: \"insensitive\",\n              },\n            }\n          : {}),\n        ...(storeId ? { storeId: Number(storeId) } : {}),\n        ...(minPrice ? { price: { gte: Number(minPrice) } } : {}),\n        ...(maxPrice ? { price: { lte: Number(maxPrice) } } : {}),\n      },\n      include: {\n        store: {\n          select: {\n            id: true,\n            name: true,\n            lat: true,\n            lng: true,\n            clusterId: true,\n          },\n        },\n      },\n      orderBy: { id: \"desc\" },\n    });\n\n    // If no geo filtering, return raw array\n    if (!Number.isFinite(lat) || !Number.isFinite(lng)) {\n      return NextResponse.json(products);\n    }\n\n    // Apply radius filtering\n    const filteredProducts = products\n      .map((product) => ({\n        ...product,\n        distanceKm: distanceKm(lat, lng, product.store.lat, product.store.lng),\n      }))\n      .filter((product) => product.distanceKm <= radiusKm)\n      .sort((a, b) => a.distanceKm - b.distanceKm);\n\n    return NextResponse.json(filteredProducts);\n  } catch (err) {\n    console.error(\"PUBLIC PRODUCTS ERROR:\", err);\n    return NextResponse.json(\n      { message: \"Internal server error\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAE5C,MAAM,QAAQ,aAAa,GAAG,CAAC,UAAU;QACzC,MAAM,UAAU,aAAa,GAAG,CAAC;QACjC,MAAM,WAAW,aAAa,GAAG,CAAC;QAClC,MAAM,WAAW,aAAa,GAAG,CAAC;QAClC,MAAM,WAAW,aAAa,GAAG,CAAC;QAClC,MAAM,WAAW,aAAa,GAAG,CAAC;QAClC,MAAM,gBAAgB,aAAa,GAAG,CAAC;QAEvC,MAAM,MAAM,WAAW,OAAO,YAAY;QAC1C,MAAM,MAAM,WAAW,OAAO,YAAY;QAC1C,MAAM,WAAW,gBAAgB,OAAO,iBAAiB;QAEzD,MAAM,WAAW,MAAM,gIAAM,CAAC,OAAO,CAAC,QAAQ,CAAC;YAC7C,OAAO;gBACL,GAAI,QACA;oBACE,MAAM;wBACJ,UAAU;wBACV,MAAM;oBACR;gBACF,IACA,CAAC,CAAC;gBACN,GAAI,UAAU;oBAAE,SAAS,OAAO;gBAAS,IAAI,CAAC,CAAC;gBAC/C,GAAI,WAAW;oBAAE,OAAO;wBAAE,KAAK,OAAO;oBAAU;gBAAE,IAAI,CAAC,CAAC;gBACxD,GAAI,WAAW;oBAAE,OAAO;wBAAE,KAAK,OAAO;oBAAU;gBAAE,IAAI,CAAC,CAAC;YAC1D;YACA,SAAS;gBACP,OAAO;oBACL,QAAQ;wBACN,IAAI;wBACJ,MAAM;wBACN,KAAK;wBACL,KAAK;wBACL,WAAW;oBACb;gBACF;YACF;YACA,SAAS;gBAAE,IAAI;YAAO;QACxB;QAEA,wCAAwC;QACxC,IAAI,CAAC,OAAO,QAAQ,CAAC,QAAQ,CAAC,OAAO,QAAQ,CAAC,MAAM;YAClD,OAAO,gJAAY,CAAC,IAAI,CAAC;QAC3B;QAEA,yBAAyB;QACzB,MAAM,mBAAmB,SACtB,GAAG,CAAC,CAAC,UAAY,CAAC;gBACjB,GAAG,OAAO;gBACV,YAAY,IAAA,iIAAU,EAAC,KAAK,KAAK,QAAQ,KAAK,CAAC,GAAG,EAAE,QAAQ,KAAK,CAAC,GAAG;YACvE,CAAC,GACA,MAAM,CAAC,CAAC,UAAY,QAAQ,UAAU,IAAI,UAC1C,IAAI,CAAC,CAAC,GAAG,IAAM,EAAE,UAAU,GAAG,EAAE,UAAU;QAE7C,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,0BAA0B;QACxC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,SAAS;QAAwB,GACnC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}