{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Ribhav/OneDrive/Documents/Projects/Major%20project%20final/localli/src/app/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useMemo, useState } from \"react\";\nimport Image from \"next/image\";\nimport Link from \"next/link\";\nimport { authFetch } from \"@/lib/authFetch\";\n\ntype Product = {\n  id: number;\n  name: string;\n  price: number;\n  stock: number;\n  store: {\n    id: number;\n    name: string;\n    clusterId: string;\n  };\n};\n\nconst productImages = [\n  \"https://images.unsplash.com/photo-1582655299221-2b6bff351df0?auto=format&fit=crop&w=900&q=80\",\n  \"https://images.unsplash.com/photo-1549931319-a545dcf3bc73?auto=format&fit=crop&w=900&q=80\",\n  \"https://images.unsplash.com/photo-1582722872445-44dc5f7e3c8f?auto=format&fit=crop&w=900&q=80\",\n  \"https://images.unsplash.com/photo-1517701550927-30cf4ba1f5f5?auto=format&fit=crop&w=900&q=80\",\n];\n\nexport default function HomePage() {\n  const [products, setProducts] = useState<Product[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [pendingProductIds, setPendingProductIds] = useState<Set<number>>(new Set());\n  const [feedbackByProductId, setFeedbackByProductId] = useState<Record<number, string>>({});\n\n  useEffect(() => {\n    let active = true;\n\n    async function loadProducts() {\n      try {\n        setLoading(true);\n        setError(null);\n\n        const response = await fetch(\"/api/products\");\n        if (!response.ok) {\n          throw new Error(\"Unable to load products right now.\");\n        }\n\n        const data = (await response.json()) as Product[];\n        if (!active) {\n          return;\n        }\n\n        setProducts(Array.isArray(data) ? data : []);\n      } catch (err) {\n        if (!active) {\n          return;\n        }\n\n        const message =\n          err instanceof Error ? err.message : \"Something went wrong while loading products.\";\n        setError(message);\n      } finally {\n        if (active) {\n          setLoading(false);\n        }\n      }\n    }\n\n    void loadProducts();\n\n    return () => {\n      active = false;\n    };\n  }, []);\n\n  const displayProducts = useMemo(() => products.slice(0, 8), [products]);\n\n  async function handleAddToCart(productId: number) {\n    setPendingProductIds((prev) => {\n      const next = new Set(prev);\n      next.add(productId);\n      return next;\n    });\n    setFeedbackByProductId((prev) => ({ ...prev, [productId]: \"\" }));\n\n    try {\n      const response = await authFetch(\"/api/cart\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({ productId, quantity: 1 }),\n      });\n\n      const data = (await response.json()) as { message?: string };\n      if (!response.ok) {\n        throw new Error(data.message ?? \"Failed to add to cart.\");\n      }\n\n      setFeedbackByProductId((prev) => ({ ...prev, [productId]: \"Added to cart.\" }));\n    } catch (err) {\n      const message =\n        err instanceof Error ? err.message : \"Unable to add this product right now.\";\n      setFeedbackByProductId((prev) => ({ ...prev, [productId]: message }));\n    } finally {\n      setPendingProductIds((prev) => {\n        const next = new Set(prev);\n        next.delete(productId);\n        return next;\n      });\n    }\n  }\n\n  return (\n    <div className=\"min-h-screen bg-black text-white\">\n      <main className=\"mx-auto max-w-7xl px-6 py-16\">\n        <section className=\"mx-auto max-w-4xl text-center\">\n          <h1 className=\"text-5xl font-bold leading-tight\">Discover What&apos;s Near You</h1>\n          <p className=\"mt-4 text-lg text-zinc-400\">\n            Support local businesses and get fresh products delivered to your door\n          </p>\n\n          <div className=\"mx-auto mt-10 flex max-w-4xl flex-col gap-4 sm:flex-row\">\n            <div className=\"flex flex-1 items-center rounded-lg border border-zinc-800 bg-zinc-900 px-4 py-3\">\n              <svg\n                aria-hidden=\"true\"\n                className=\"mr-3 h-5 w-5 text-zinc-500\"\n                fill=\"none\"\n                viewBox=\"0 0 24 24\"\n                xmlns=\"http://www.w3.org/2000/svg\"\n              >\n                <circle cx=\"11\" cy=\"11\" r=\"7\" stroke=\"currentColor\" strokeWidth=\"2\" />\n                <path d=\"M20 20L17 17\" stroke=\"currentColor\" strokeLinecap=\"round\" strokeWidth=\"2\" />\n              </svg>\n              <input\n                className=\"w-full bg-transparent text-zinc-100 outline-none placeholder:text-zinc-500\"\n                placeholder=\"Search products, stores...\"\n                type=\"text\"\n              />\n            </div>\n\n            <button\n              className=\"rounded-lg bg-zinc-800 px-6 py-3 text-sm font-medium text-zinc-100 transition hover:bg-zinc-700\"\n              type=\"button\"\n            >\n              Location\n            </button>\n          </div>\n        </section>\n\n        <section className=\"mt-20\">\n          <h2 className=\"text-2xl font-semibold\">Available Products</h2>\n          {loading ? (\n            <div className=\"mt-6 rounded-xl border border-zinc-800 bg-zinc-900 p-6 text-zinc-300\">\n              Loading products...\n            </div>\n          ) : error ? (\n            <div className=\"mt-6 rounded-xl border border-red-900/40 bg-red-950/20 p-6 text-red-300\">\n              {error}\n            </div>\n          ) : displayProducts.length === 0 ? (\n            <div className=\"mt-6 rounded-xl border border-zinc-800 bg-zinc-900 p-6 text-zinc-400\">\n              No products available at the moment.\n            </div>\n          ) : (\n            <div className=\"mt-6 grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-4\">\n              {displayProducts.map((product, index) => {\n                const pending = pendingProductIds.has(product.id);\n                const outOfStock = product.stock <= 0;\n                const feedback = feedbackByProductId[product.id];\n\n                return (\n                  <article\n                    className=\"overflow-hidden rounded-2xl border border-zinc-800 bg-zinc-900/95\"\n                    key={product.id}\n                  >\n                    <Link className=\"block\" href={`/products/${product.id}`}>\n                      <div className=\"relative aspect-[4/3] w-full\">\n                        <Image\n                          alt={product.name}\n                          className=\"h-full w-full object-cover\"\n                          fill\n                          sizes=\"(max-width: 768px) 100vw, 25vw\"\n                          src={productImages[index % productImages.length]}\n                        />\n                      </div>\n                    </Link>\n                    <div className=\"p-5\">\n                      <Link\n                        className=\"line-clamp-1 text-[1.75rem]/7 font-semibold tracking-tight text-zinc-100 transition hover:text-white\"\n                        href={`/products/${product.id}`}\n                      >\n                        {product.name}\n                      </Link>\n                      <p className=\"mt-1 text-xl font-medium text-zinc-400\">{product.store.name}</p>\n\n                      <div className=\"mt-4 flex items-center justify-between\">\n                        <p className=\"text-[2rem] font-bold text-white\">\n                          ${product.price.toFixed(2)}\n                        </p>\n                        <span\n                          className={`rounded-full px-3 py-1 text-sm ${\n                            outOfStock\n                              ? \"bg-red-950/70 text-red-300\"\n                              : \"bg-emerald-950/70 text-emerald-300\"\n                          }`}\n                        >\n                          {outOfStock ? \"Out of stock\" : `${product.stock} in stock`}\n                        </span>\n                      </div>\n\n                      <button\n                        className=\"mt-4 w-full rounded-xl bg-[#4F7CFF] px-3 py-3 text-xl font-semibold text-white transition hover:bg-[#3f6ef2] disabled:cursor-not-allowed disabled:bg-zinc-700 disabled:text-zinc-400\"\n                        disabled={outOfStock || pending}\n                        onClick={() => void handleAddToCart(product.id)}\n                        type=\"button\"\n                      >\n                        {pending ? \"Adding...\" : \"Add to cart\"}\n                      </button>\n\n                      {feedback ? (\n                        <p\n                          className={`mt-2 text-sm ${\n                            feedback === \"Added to cart.\" ? \"text-[#30D158]\" : \"text-red-400\"\n                          }`}\n                        >\n                          {feedback}\n                        </p>\n                      ) : null}\n                    </div>\n                  </article>\n                );\n              })}\n            </div>\n          )}\n        </section>\n      </main>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}