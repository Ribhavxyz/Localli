{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Ribhav/OneDrive/Documents/Projects/Major%20project%20final/localli/src/app/cart/page.tsx"],"sourcesContent":["\"use client\";\n\nimport Image from \"next/image\";\nimport Link from \"next/link\";\nimport { useEffect, useMemo, useState } from \"react\";\nimport { authFetch } from \"@/lib/authFetch\";\n\ntype CartItem = {\n  id: number;\n  userId: number;\n  productId: number;\n  quantity: number;\n  product: {\n    id: number;\n    name: string;\n    price: number;\n    stock: number;\n    storeId: number;\n    imageUrl?: string | null;\n  };\n};\n\ntype ApiError = {\n  message?: string;\n};\n\nexport default function CartPage() {\n  const [items, setItems] = useState<CartItem[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [updatingById, setUpdatingById] = useState<Record<number, boolean>>({});\n  const [removingById, setRemovingById] = useState<Record<number, boolean>>({});\n\n  const subtotal = useMemo(\n    () => items.reduce((sum, item) => sum + item.product.price * item.quantity, 0),\n    [items]\n  );\n  const delivery = items.length > 0 ? 4.99 : 0;\n  const tax = useMemo(() => subtotal * 0.08, [subtotal]);\n  const totalPrice = subtotal + delivery + tax;\n\n  const fallbackImages = [\n    \"https://images.unsplash.com/photo-1582655299221-2b6bff351df0?auto=format&fit=crop&w=900&q=80\",\n    \"https://images.unsplash.com/photo-1549931319-a545dcf3bc73?auto=format&fit=crop&w=900&q=80\",\n    \"https://images.unsplash.com/photo-1582722872445-44dc5f7e3c8f?auto=format&fit=crop&w=900&q=80\",\n    \"https://images.unsplash.com/photo-1517701550927-30cf4ba1f5f5?auto=format&fit=crop&w=900&q=80\",\n  ];\n\n  async function fetchCart() {\n    try {\n      setLoading(true);\n      setError(null);\n\n      const response = await authFetch(\"/api/cart\");\n      const data = (await response.json()) as CartItem[] | ApiError;\n\n      if (!response.ok) {\n        throw new Error(\n          !Array.isArray(data) && data.message ? data.message : \"Failed to load cart items.\"\n        );\n      }\n\n      const nextItems = Array.isArray(data) ? data : [];\n      setItems(nextItems);\n    } catch (err) {\n      const message =\n        err instanceof Error ? err.message : \"Unable to load your cart right now.\";\n      setError(message);\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  useEffect(() => {\n    void fetchCart();\n  }, []);\n\n  async function handleUpdateQuantity(item: CartItem, nextQuantity: number) {\n    if (!Number.isInteger(nextQuantity) || nextQuantity <= 0) {\n      return;\n    }\n\n    try {\n      setError(null);\n      setUpdatingById((prev) => ({ ...prev, [item.id]: true }));\n\n      const response = await authFetch(`/api/cart/${item.id}`, {\n        method: \"PATCH\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({ quantity: nextQuantity }),\n      });\n\n      const data = (await response.json()) as ApiError;\n      if (!response.ok) {\n        throw new Error(data.message ?? \"Failed to update quantity.\");\n      }\n\n      setItems((prev) =>\n        prev.map((row) => (row.id === item.id ? { ...row, quantity: nextQuantity } : row))\n      );\n    } catch (err) {\n      const message =\n        err instanceof Error ? err.message : \"Unable to update quantity right now.\";\n      setError(message);\n    } finally {\n      setUpdatingById((prev) => ({ ...prev, [item.id]: false }));\n    }\n  }\n\n  async function handleRemove(item: CartItem) {\n    try {\n      setError(null);\n      setRemovingById((prev) => ({ ...prev, [item.id]: true }));\n\n      const response = await authFetch(`/api/cart/${item.id}`, {\n        method: \"DELETE\",\n      });\n\n      const data = (await response.json()) as ApiError;\n      if (!response.ok) {\n        throw new Error(data.message ?? \"Failed to remove cart item.\");\n      }\n\n      setItems((prev) => prev.filter((row) => row.id !== item.id));\n    } catch (err) {\n      const message =\n        err instanceof Error ? err.message : \"Unable to remove item right now.\";\n      setError(message);\n    } finally {\n      setRemovingById((prev) => ({ ...prev, [item.id]: false }));\n    }\n  }\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-black px-6 py-16 text-white\">\n        <div className=\"mx-auto max-w-7xl rounded-2xl border border-zinc-800 bg-zinc-900/70 p-10 text-center text-zinc-300\">\n          Loading cart...\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-black px-6 py-16 text-white\">\n      <div className=\"mx-auto max-w-7xl\">\n        <h1 className=\"mb-10 text-5xl font-bold tracking-tight\">Shopping Cart</h1>\n\n        {error ? (\n          <div className=\"mb-6 rounded-xl border border-[#FF453A]/40 bg-[#FF453A]/10 p-4 text-sm text-[#FF8A80]\">\n            {error}\n          </div>\n        ) : null}\n\n        {items.length === 0 ? (\n          <div className=\"rounded-2xl border border-dashed border-zinc-700 bg-zinc-900/70 p-10 text-center text-zinc-400\">\n            Your cart is empty.\n          </div>\n        ) : (\n          <div className=\"grid grid-cols-1 gap-6 lg:grid-cols-[1fr_420px]\">\n            <div className=\"space-y-4\">\n              {items.map((item, index) => {\n                const isUpdating = Boolean(updatingById[item.id]);\n                const isRemoving = Boolean(removingById[item.id]);\n                const pending = isUpdating || isRemoving;\n\n                return (\n                  <div\n                    className=\"rounded-2xl border border-zinc-800 bg-zinc-900/90 p-5\"\n                    key={item.id}\n                  >\n                    <div className=\"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between\">\n                      <div className=\"flex items-center gap-4\">\n                        <div className=\"relative h-24 w-24 overflow-hidden rounded-xl bg-zinc-800\">\n                          <Image\n                            alt={item.product.name}\n                            className=\"h-full w-full object-cover\"\n                            fill\n                            sizes=\"96px\"\n                            src={item.product.imageUrl ?? fallbackImages[index % fallbackImages.length]}\n                          />\n                        </div>\n                        <div>\n                          <p className=\"text-3xl font-semibold text-zinc-100\">{item.product.name}</p>\n                          <p className=\"mt-1 text-xl text-zinc-400\">\n                            Price: ${item.product.price.toFixed(2)}\n                          </p>\n                          <div className=\"mt-4 flex items-center gap-4\">\n                            <button\n                              className=\"h-12 w-12 rounded-xl bg-zinc-800 text-2xl text-zinc-200 transition hover:bg-zinc-700 disabled:opacity-50\"\n                              disabled={pending || item.quantity <= 1}\n                              onClick={() => void handleUpdateQuantity(item, item.quantity - 1)}\n                              type=\"button\"\n                            >\n                              -\n                            </button>\n                            <span className=\"min-w-8 text-center text-3xl font-semibold\">\n                              {item.quantity}\n                            </span>\n                            <button\n                              className=\"h-12 w-12 rounded-xl bg-zinc-800 text-2xl text-zinc-200 transition hover:bg-zinc-700 disabled:opacity-50\"\n                              disabled={pending || item.quantity >= item.product.stock}\n                              onClick={() => void handleUpdateQuantity(item, item.quantity + 1)}\n                              type=\"button\"\n                            >\n                              +\n                            </button>\n                          </div>\n                        </div>\n                      </div>\n                      <div className=\"flex items-center justify-between gap-4 sm:block\">\n                        <p className=\"text-4xl font-bold text-zinc-100\">\n                          ${(item.product.price * item.quantity).toFixed(2)}\n                        </p>\n                        <button\n                          className=\"mt-2 text-2xl text-red-400 transition hover:text-red-300 disabled:opacity-50\"\n                          disabled={pending}\n                          onClick={() => void handleRemove(item)}\n                          type=\"button\"\n                        >\n                          ðŸ—‘\n                        </button>\n                      </div>\n                    </div>\n                  </div>\n                );\n              })}\n            </div>\n\n            <div className=\"h-fit rounded-2xl border border-zinc-800 bg-zinc-900/90 p-6\">\n              <h2 className=\"text-4xl font-semibold text-zinc-100\">Order Summary</h2>\n\n              <div className=\"mt-8 space-y-4 text-2xl text-zinc-300\">\n                <div className=\"flex items-center justify-between\">\n                  <span>Subtotal</span>\n                  <span className=\"font-semibold text-zinc-100\">${subtotal.toFixed(2)}</span>\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <span>Delivery</span>\n                  <span className=\"font-semibold text-zinc-100\">${delivery.toFixed(2)}</span>\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <span>Tax</span>\n                  <span className=\"font-semibold text-zinc-100\">${tax.toFixed(2)}</span>\n                </div>\n              </div>\n\n              <div className=\"my-8 h-px bg-zinc-800\" />\n\n              <div className=\"flex items-center justify-between text-4xl font-bold\">\n                <span>Total</span>\n                <span>${totalPrice.toFixed(2)}</span>\n              </div>\n\n              <Link\n                className=\"mt-8 inline-flex w-full items-center justify-center rounded-xl bg-[#4F7CFF] px-6 py-4 text-2xl font-semibold text-white transition hover:bg-[#3f6ef2]\"\n                href=\"/checkout\"\n              >\n                Proceed to Checkout\n              </Link>\n              <Link\n                className=\"mt-5 inline-flex w-full items-center justify-center text-xl text-zinc-400 transition hover:text-zinc-200\"\n                href=\"/\"\n              >\n                Continue Shopping\n              </Link>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}