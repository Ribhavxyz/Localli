{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Ribhav/OneDrive/Documents/Projects/Major%20project%20final/localli/src/app/checkout/page.tsx"],"sourcesContent":["\"use client\";\n\nimport Image from \"next/image\";\nimport { useEffect, useMemo, useState } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport { authFetch } from \"@/lib/authFetch\";\n\ntype CartItem = {\n  id: number;\n  productId: number;\n  quantity: number;\n  product: {\n    id: number;\n    name: string;\n    price: number;\n    stock: number;\n    imageUrl?: string | null;\n  };\n};\n\ntype ApiError = {\n  message?: string;\n};\n\nexport default function CheckoutPage() {\n  const router = useRouter();\n  const [items, setItems] = useState<CartItem[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [submitting, setSubmitting] = useState(false);\n  const [success, setSuccess] = useState(false);\n\n  const subtotal = useMemo(\n    () => items.reduce((sum, item) => sum + item.product.price * item.quantity, 0),\n    [items]\n  );\n  const delivery = items.length > 0 ? 4.99 : 0;\n  const tax = useMemo(() => subtotal * 0.08, [subtotal]);\n  const totalPrice = subtotal + delivery + tax;\n\n  const fallbackImages = [\n    \"https://images.unsplash.com/photo-1582655299221-2b6bff351df0?auto=format&fit=crop&w=900&q=80\",\n    \"https://images.unsplash.com/photo-1549931319-a545dcf3bc73?auto=format&fit=crop&w=900&q=80\",\n    \"https://images.unsplash.com/photo-1582722872445-44dc5f7e3c8f?auto=format&fit=crop&w=900&q=80\",\n    \"https://images.unsplash.com/photo-1517701550927-30cf4ba1f5f5?auto=format&fit=crop&w=900&q=80\",\n  ];\n\n  useEffect(() => {\n    let active = true;\n\n    async function fetchCart() {\n      try {\n        setLoading(true);\n        setError(null);\n\n        const response = await authFetch(\"/api/cart\");\n        const data = (await response.json()) as CartItem[] | ApiError;\n\n        if (!response.ok) {\n          const message = !Array.isArray(data) ? data.message : undefined;\n          throw new Error(message ?? \"Failed to load cart items.\");\n        }\n\n        if (active) {\n          setItems(Array.isArray(data) ? data : []);\n        }\n      } catch (err) {\n        if (!active) {\n          return;\n        }\n\n        const message =\n          err instanceof Error ? err.message : \"Unable to load checkout details.\";\n        setError(message);\n      } finally {\n        if (active) {\n          setLoading(false);\n        }\n      }\n    }\n\n    void fetchCart();\n\n    return () => {\n      active = false;\n    };\n  }, []);\n\n  async function handlePlaceOrder() {\n    try {\n      setSubmitting(true);\n      setError(null);\n\n      const response = await authFetch(\"/api/checkout\", {\n        method: \"POST\",\n      });\n\n      const data = (await response.json()) as ApiError;\n      if (!response.ok) {\n        throw new Error(data.message ?? \"Failed to place order.\");\n      }\n\n      setSuccess(true);\n      setTimeout(() => {\n        router.replace(\"/orders\");\n      }, 900);\n    } catch (err) {\n      const message =\n        err instanceof Error ? err.message : \"Unable to place order right now.\";\n      setError(message);\n    } finally {\n      setSubmitting(false);\n    }\n  }\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-black px-6 py-16 text-white\">\n        <div className=\"mx-auto flex max-w-7xl items-center justify-center rounded-2xl border border-zinc-800 bg-zinc-900/80 p-10\">\n          <div className=\"flex items-center gap-3 text-zinc-300\">\n            <span className=\"h-5 w-5 animate-spin rounded-full border-2 border-zinc-500 border-t-white\" />\n            <span>Loading checkout...</span>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-black px-6 py-16 text-white\">\n      <div className=\"mx-auto w-full max-w-7xl space-y-6\">\n        <h1 className=\"text-5xl font-bold tracking-tight text-zinc-100\">Checkout</h1>\n\n        {error ? (\n          <div className=\"rounded-xl border border-[#FF453A]/40 bg-[#FF453A]/10 p-4 text-sm text-[#FF8A80]\">\n            {error}\n          </div>\n        ) : null}\n\n        {success ? (\n          <div className=\"rounded-xl border border-[#30D158]/40 bg-[#30D158]/10 p-4 text-sm text-[#7EF2A0]\">\n            Order placed successfully. Redirecting to orders...\n          </div>\n        ) : null}\n\n        {items.length === 0 ? (\n          <div className=\"rounded-2xl border border-dashed border-zinc-700 bg-zinc-900/80 p-10 text-center text-zinc-400\">\n            Your cart is empty.\n          </div>\n        ) : (\n          <div className=\"grid grid-cols-1 gap-6 lg:grid-cols-[1fr_1fr]\">\n            <div className=\"rounded-2xl border border-zinc-800 bg-zinc-900/90 p-6\">\n              <h2 className=\"text-4xl font-semibold text-zinc-100\">Order Summary</h2>\n              <div className=\"mt-6 space-y-4\">\n                {items.map((item, index) => (\n                  <div\n                    className=\"flex items-center justify-between border-b border-zinc-800 pb-4 last:border-b-0 last:pb-0\"\n                    key={item.id}\n                  >\n                    <div className=\"flex items-center gap-4\">\n                      <div className=\"relative h-20 w-20 overflow-hidden rounded-xl bg-zinc-800\">\n                        <Image\n                          alt={item.product.name}\n                          className=\"object-cover\"\n                          fill\n                          sizes=\"80px\"\n                          src={item.product.imageUrl ?? fallbackImages[index % fallbackImages.length]}\n                        />\n                      </div>\n                      <div>\n                        <p className=\"text-2xl font-semibold text-zinc-100\">{item.product.name}</p>\n                        <p className=\"text-xl text-zinc-400\">Qty: {item.quantity}</p>\n                      </div>\n                    </div>\n                    <p className=\"text-3xl font-semibold text-zinc-100\">\n                      ${(item.product.price * item.quantity).toFixed(2)}\n                    </p>\n                  </div>\n                ))}\n              </div>\n\n              <div className=\"mt-8 space-y-3 border-t border-zinc-800 pt-6 text-2xl text-zinc-300\">\n                <div className=\"flex items-center justify-between\">\n                  <span>Subtotal</span>\n                  <span className=\"font-semibold text-zinc-100\">${subtotal.toFixed(2)}</span>\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <span>Delivery</span>\n                  <span className=\"font-semibold text-zinc-100\">${delivery.toFixed(2)}</span>\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <span>Tax</span>\n                  <span className=\"font-semibold text-zinc-100\">${tax.toFixed(2)}</span>\n                </div>\n                <div className=\"mt-4 flex items-center justify-between border-t border-zinc-800 pt-4 text-4xl font-bold text-zinc-100\">\n                  <span>Total</span>\n                  <span>${totalPrice.toFixed(2)}</span>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"space-y-6\">\n              <div className=\"rounded-2xl border border-zinc-800 bg-zinc-900/90 p-6\">\n                <h2 className=\"text-4xl font-semibold text-zinc-100\">Delivery Address</h2>\n                <div className=\"mt-4 grid grid-cols-1 gap-4\">\n                  <input\n                    className=\"rounded-xl border border-zinc-800 bg-black px-4 py-3 text-lg text-zinc-100 outline-none ring-[#4F7CFF] placeholder:text-zinc-500 focus:ring-2\"\n                    placeholder=\"Street Address\"\n                    type=\"text\"\n                  />\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <input\n                      className=\"rounded-xl border border-zinc-800 bg-black px-4 py-3 text-lg text-zinc-100 outline-none ring-[#4F7CFF] placeholder:text-zinc-500 focus:ring-2\"\n                      placeholder=\"City\"\n                      type=\"text\"\n                    />\n                    <input\n                      className=\"rounded-xl border border-zinc-800 bg-black px-4 py-3 text-lg text-zinc-100 outline-none ring-[#4F7CFF] placeholder:text-zinc-500 focus:ring-2\"\n                      placeholder=\"ZIP Code\"\n                      type=\"text\"\n                    />\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"rounded-2xl border border-zinc-800 bg-zinc-900/90 p-6\">\n                <h2 className=\"text-4xl font-semibold text-zinc-100\">Payment Method</h2>\n                <div className=\"mt-4 grid grid-cols-1 gap-4\">\n                  <input\n                    className=\"rounded-xl border border-zinc-800 bg-black px-4 py-3 text-lg text-zinc-100 outline-none ring-[#4F7CFF] placeholder:text-zinc-500 focus:ring-2\"\n                    placeholder=\"Card Number\"\n                    type=\"text\"\n                  />\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <input\n                      className=\"rounded-xl border border-zinc-800 bg-black px-4 py-3 text-lg text-zinc-100 outline-none ring-[#4F7CFF] placeholder:text-zinc-500 focus:ring-2\"\n                      placeholder=\"MM/YY\"\n                      type=\"text\"\n                    />\n                    <input\n                      className=\"rounded-xl border border-zinc-800 bg-black px-4 py-3 text-lg text-zinc-100 outline-none ring-[#4F7CFF] placeholder:text-zinc-500 focus:ring-2\"\n                      placeholder=\"CVV\"\n                      type=\"text\"\n                    />\n                  </div>\n                </div>\n              </div>\n\n              <button\n                className=\"inline-flex w-full items-center justify-center rounded-xl bg-[#4F7CFF] px-6 py-4 text-3xl font-semibold text-white transition hover:bg-[#3f6ef2] disabled:cursor-not-allowed disabled:bg-zinc-700 disabled:text-zinc-400\"\n                disabled={submitting || success}\n                onClick={() => void handlePlaceOrder()}\n                type=\"button\"\n              >\n                {submitting ? \"Placing Order...\" : \"Confirm Order\"}\n              </button>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}