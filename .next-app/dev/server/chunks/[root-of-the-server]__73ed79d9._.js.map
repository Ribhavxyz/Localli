{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Ribhav/OneDrive/Documents/Projects/Major%20project%20final/localli/src/app/api/analytics/cluster-intelligence/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\n\ntype DemandCluster = {\n  clusterId: string;\n  currentDemandScore: number;\n  previousDemandScore: number;\n  growthRate: number;\n  isSurging: boolean;\n  latitude?: number;\n  longitude?: number;\n};\n\ntype CompetitionCluster = {\n  clusterId: string;\n  competitionIndex: number;\n  opportunityScore: number;\n  latitude?: number;\n  longitude?: number;\n};\n\ntype DemandResponse = {\n  clusters: DemandCluster[];\n};\n\ntype CompetitionResponse = {\n  clusters: CompetitionCluster[];\n};\n\ntype UnifiedCluster = {\n  clusterId: string;\n  currentDemandScore: number;\n  previousDemandScore: number;\n  growthRate: number;\n  isSurging: boolean;\n  competitionIndex: number;\n  opportunityScore: number;\n  latitude: number;\n  longitude: number;\n};\n\nexport async function GET(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const daysParam = searchParams.get(\"days\");\n\n    if (daysParam === null || daysParam.trim() === \"\") {\n      return NextResponse.json(\n        { message: \"days query parameter is required\" },\n        { status: 400 }\n      );\n    }\n\n    const days = Number(daysParam);\n    if (!Number.isFinite(days) || days <= 0) {\n      return NextResponse.json(\n        { message: \"days must be a positive number\" },\n        { status: 400 }\n      );\n    }\n\n    const baseUrl = process.env.NEXT_PUBLIC_BASE_URL ?? request.nextUrl.origin;\n\n    const demandRes = await fetch(\n      `${baseUrl}/api/analytics/cluster-demand?days=${days}`,\n      { cache: \"no-store\" }\n    );\n    const competitionRes = await fetch(\n      `${baseUrl}/api/analytics/cluster-competition?days=${days}`,\n      { cache: \"no-store\" }\n    );\n\n    if (!demandRes.ok || !competitionRes.ok) {\n      return NextResponse.json(\n        { message: \"Failed to fetch upstream analytics endpoints\" },\n        { status: 502 }\n      );\n    }\n\n    const demandData = (await demandRes.json()) as DemandResponse;\n    const competitionData = (await competitionRes.json()) as CompetitionResponse;\n\n    const demandClusters = Array.isArray(demandData.clusters) ? demandData.clusters : [];\n    const competitionClusters = Array.isArray(competitionData.clusters)\n      ? competitionData.clusters\n      : [];\n\n    const competitionByClusterId = new Map<string, CompetitionCluster>(\n      competitionClusters.map((cluster) => [cluster.clusterId, cluster])\n    );\n\n    const mergedClusters: UnifiedCluster[] = demandClusters.map((cluster) => {\n      const competition = competitionByClusterId.get(cluster.clusterId);\n\n      return {\n        clusterId: cluster.clusterId,\n        currentDemandScore: cluster.currentDemandScore,\n        previousDemandScore: cluster.previousDemandScore,\n        growthRate: cluster.growthRate,\n        isSurging: cluster.isSurging,\n        competitionIndex: competition?.competitionIndex ?? 0,\n        opportunityScore: competition?.opportunityScore ?? 0,\n        latitude: cluster.latitude ?? competition?.latitude ?? 0,\n        longitude: cluster.longitude ?? competition?.longitude ?? 0,\n      };\n    });\n\n    return NextResponse.json({ clusters: mergedClusters }, { status: 200 });\n  } catch {\n    return NextResponse.json(\n      { message: \"Failed to compute unified cluster intelligence analytics\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;;AAwCO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,YAAY,aAAa,GAAG,CAAC;QAEnC,IAAI,cAAc,QAAQ,UAAU,IAAI,OAAO,IAAI;YACjD,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;YAAmC,GAC9C;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,OAAO,OAAO;QACpB,IAAI,CAAC,OAAO,QAAQ,CAAC,SAAS,QAAQ,GAAG;YACvC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;YAAiC,GAC5C;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,UAAU,QAAQ,GAAG,CAAC,oBAAoB,IAAI,QAAQ,OAAO,CAAC,MAAM;QAE1E,MAAM,YAAY,MAAM,MACtB,GAAG,QAAQ,mCAAmC,EAAE,MAAM,EACtD;YAAE,OAAO;QAAW;QAEtB,MAAM,iBAAiB,MAAM,MAC3B,GAAG,QAAQ,wCAAwC,EAAE,MAAM,EAC3D;YAAE,OAAO;QAAW;QAGtB,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,eAAe,EAAE,EAAE;YACvC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;YAA+C,GAC1D;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,aAAc,MAAM,UAAU,IAAI;QACxC,MAAM,kBAAmB,MAAM,eAAe,IAAI;QAElD,MAAM,iBAAiB,MAAM,OAAO,CAAC,WAAW,QAAQ,IAAI,WAAW,QAAQ,GAAG,EAAE;QACpF,MAAM,sBAAsB,MAAM,OAAO,CAAC,gBAAgB,QAAQ,IAC9D,gBAAgB,QAAQ,GACxB,EAAE;QAEN,MAAM,yBAAyB,IAAI,IACjC,oBAAoB,GAAG,CAAC,CAAC,UAAY;gBAAC,QAAQ,SAAS;gBAAE;aAAQ;QAGnE,MAAM,iBAAmC,eAAe,GAAG,CAAC,CAAC;YAC3D,MAAM,cAAc,uBAAuB,GAAG,CAAC,QAAQ,SAAS;YAEhE,OAAO;gBACL,WAAW,QAAQ,SAAS;gBAC5B,oBAAoB,QAAQ,kBAAkB;gBAC9C,qBAAqB,QAAQ,mBAAmB;gBAChD,YAAY,QAAQ,UAAU;gBAC9B,WAAW,QAAQ,SAAS;gBAC5B,kBAAkB,aAAa,oBAAoB;gBACnD,kBAAkB,aAAa,oBAAoB;gBACnD,UAAU,QAAQ,QAAQ,IAAI,aAAa,YAAY;gBACvD,WAAW,QAAQ,SAAS,IAAI,aAAa,aAAa;YAC5D;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,UAAU;QAAe,GAAG;YAAE,QAAQ;QAAI;IACvE,EAAE,OAAM;QACN,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,SAAS;QAA2D,GACtE;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}