{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Ribhav/OneDrive/Documents/Projects/Major%20project%20final/localli/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\r\n\r\nconst globalForPrisma = global as unknown as { prisma: PrismaClient };\r\n\r\nexport const prisma =\r\n  globalForPrisma.prisma ||\r\n  new PrismaClient({\r\n    log: [\"query\"],\r\n  });\r\n\r\nif (process.env.NODE_ENV !== \"production\")\r\n  globalForPrisma.prisma = prisma;\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AAEC,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,sMAAY,CAAC;IACf,KAAK;QAAC;KAAQ;AAChB;AAEF,wCACE,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 87, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Ribhav/OneDrive/Documents/Projects/Major%20project%20final/localli/src/lib/api.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\n\nexport function jsonError(message: string, status: number) {\n  return NextResponse.json({ error: message }, { status });\n}\n\n"],"names":[],"mappings":";;;;AAAA;;AAEO,SAAS,UAAU,OAAe,EAAE,MAAc;IACvD,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAAQ,GAAG;QAAE;IAAO;AACxD"}},
    {"offset": {"line": 104, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Ribhav/OneDrive/Documents/Projects/Major%20project%20final/localli/src/lib/auth.ts"],"sourcesContent":["import { Role } from \"@prisma/client\";\nimport { NextRequest, NextResponse } from \"next/server\";\nimport jwt, { JwtPayload } from \"jsonwebtoken\";\nimport { jsonError } from \"@/lib/api\";\n\ntype AuthPayload = {\n  userId: number;\n  role: Role;\n};\n\nexport function signToken(payload: AuthPayload) {\n  const jwtSecret = process.env.JWT_SECRET;\n  if (!jwtSecret) {\n    throw new Error(\"JWT_SECRET is required\");\n  }\n\n  return jwt.sign(payload, jwtSecret, { expiresIn: \"7d\" });\n}\n\nfunction getJwtSecret() {\n  return process.env.JWT_SECRET ?? null;\n}\n\nfunction verifyToken(token: string): AuthPayload | null {\n  const jwtSecret = getJwtSecret();\n  if (!jwtSecret) {\n    return null;\n  }\n\n  try {\n    const decoded = jwt.verify(token, jwtSecret) as JwtPayload & Partial<AuthPayload>;\n    if (\n      typeof decoded.userId !== \"number\" ||\n      (decoded.role !== \"CUSTOMER\" && decoded.role !== \"VENDOR\" && decoded.role !== \"ADMIN\")\n    ) {\n      return null;\n    }\n\n    return {\n      userId: decoded.userId,\n      role: decoded.role,\n    };\n  } catch {\n    return null;\n  }\n}\n\nexport function getAuthContext(\n  request: NextRequest\n): { auth: AuthPayload; error: null } | { auth: null; error: NextResponse } {\n  const header = request.headers.get(\"authorization\");\n\n  if (!header || !header.startsWith(\"Bearer \")) {\n    return { auth: null, error: jsonError(\"Unauthorized\", 401) };\n  }\n\n  const token = header.slice(\"Bearer \".length).trim();\n  const auth = verifyToken(token);\n\n  if (!auth) {\n    return { auth: null, error: jsonError(\"Invalid token\", 401) };\n  }\n\n  return { auth, error: null };\n}\n\nexport function requireRole(auth: AuthPayload, role: Role): NextResponse | null {\n  if (auth.role !== role) {\n    return jsonError(\"Forbidden\", 403);\n  }\n\n  return null;\n}\n\nexport function requireAnyRole(auth: AuthPayload, roles: Role[]): NextResponse | null {\n  if (!roles.includes(auth.role)) {\n    return jsonError(\"Forbidden\", 403);\n  }\n\n  return null;\n}\n\nexport type { AuthPayload };\n"],"names":[],"mappings":";;;;;;;;;;AAEA;AACA;;;AAOO,SAAS,UAAU,OAAoB;IAC5C,MAAM,YAAY,QAAQ,GAAG,CAAC,UAAU;IACxC,IAAI,CAAC,WAAW;QACd,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO,kJAAG,CAAC,IAAI,CAAC,SAAS,WAAW;QAAE,WAAW;IAAK;AACxD;AAEA,SAAS;IACP,OAAO,QAAQ,GAAG,CAAC,UAAU,IAAI;AACnC;AAEA,SAAS,YAAY,KAAa;IAChC,MAAM,YAAY;IAClB,IAAI,CAAC,WAAW;QACd,OAAO;IACT;IAEA,IAAI;QACF,MAAM,UAAU,kJAAG,CAAC,MAAM,CAAC,OAAO;QAClC,IACE,OAAO,QAAQ,MAAM,KAAK,YACzB,QAAQ,IAAI,KAAK,cAAc,QAAQ,IAAI,KAAK,YAAY,QAAQ,IAAI,KAAK,SAC9E;YACA,OAAO;QACT;QAEA,OAAO;YACL,QAAQ,QAAQ,MAAM;YACtB,MAAM,QAAQ,IAAI;QACpB;IACF,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,SAAS,eACd,OAAoB;IAEpB,MAAM,SAAS,QAAQ,OAAO,CAAC,GAAG,CAAC;IAEnC,IAAI,CAAC,UAAU,CAAC,OAAO,UAAU,CAAC,YAAY;QAC5C,OAAO;YAAE,MAAM;YAAM,OAAO,IAAA,gIAAS,EAAC,gBAAgB;QAAK;IAC7D;IAEA,MAAM,QAAQ,OAAO,KAAK,CAAC,UAAU,MAAM,EAAE,IAAI;IACjD,MAAM,OAAO,YAAY;IAEzB,IAAI,CAAC,MAAM;QACT,OAAO;YAAE,MAAM;YAAM,OAAO,IAAA,gIAAS,EAAC,iBAAiB;QAAK;IAC9D;IAEA,OAAO;QAAE;QAAM,OAAO;IAAK;AAC7B;AAEO,SAAS,YAAY,IAAiB,EAAE,IAAU;IACvD,IAAI,KAAK,IAAI,KAAK,MAAM;QACtB,OAAO,IAAA,gIAAS,EAAC,aAAa;IAChC;IAEA,OAAO;AACT;AAEO,SAAS,eAAe,IAAiB,EAAE,KAAa;IAC7D,IAAI,CAAC,MAAM,QAAQ,CAAC,KAAK,IAAI,GAAG;QAC9B,OAAO,IAAA,gIAAS,EAAC,aAAa;IAChC;IAEA,OAAO;AACT"}},
    {"offset": {"line": 185, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Ribhav/OneDrive/Documents/Projects/Major%20project%20final/localli/src/app/api/vendor/analytics/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { prisma } from \"@/lib/prisma\";\nimport { getAuthContext, requireRole } from \"@/lib/auth\";\n\ntype TopProduct = {\n  id: number;\n  name: string;\n  totalPurchases: number;\n};\n\ntype CategorySales = {\n  category: string;\n  revenue: number;\n  unitsSold: number;\n  orders: number;\n};\n\ntype VendorAnalyticsResponse = {\n  totalProducts: number;\n  totalClicks: number;\n  totalCartAdds: number;\n  totalPurchases: number;\n  totalRevenue: number;\n  topProducts: TopProduct[];\n  categorySales: CategorySales[];\n};\n\nfunction deriveCategory(productName: string): string {\n  const value = productName.toLowerCase();\n  if (value.includes(\"bread\") || value.includes(\"bake\")) return \"Bakery\";\n  if (value.includes(\"egg\") || value.includes(\"milk\") || value.includes(\"cheese\"))\n    return \"Dairy\";\n  if (value.includes(\"coffee\") || value.includes(\"drink\") || value.includes(\"tea\"))\n    return \"Beverages\";\n  if (value.includes(\"fruit\") || value.includes(\"vegetable\") || value.includes(\"avocado\"))\n    return \"Produce\";\n  return \"General\";\n}\n\nexport async function GET(request: NextRequest) {\n  const { auth, error } = getAuthContext(request);\n  if (error) {\n    return error;\n  }\n\n  const roleError = requireRole(auth, \"VENDOR\");\n  if (roleError) {\n    return roleError;\n  }\n\n  try {\n    const store = await prisma.store.findUnique({\n      where: { vendorId: auth.userId },\n      select: { id: true },\n    });\n\n    if (!store) {\n      return NextResponse.json({ message: \"Store not found\" }, { status: 404 });\n    }\n\n    const products = await prisma.product.findMany({\n      where: { storeId: store.id },\n      select: { id: true, name: true },\n    });\n\n    const totalProducts = products.length;\n    const productIds = products.map((product) => product.id);\n\n    if (productIds.length === 0) {\n      const emptyResponse: VendorAnalyticsResponse = {\n        totalProducts,\n        totalClicks: 0,\n        totalCartAdds: 0,\n        totalPurchases: 0,\n        totalRevenue: 0,\n        topProducts: [],\n        categorySales: [],\n      };\n\n      return NextResponse.json(emptyResponse, { status: 200 });\n    }\n\n    const [interactionCounts, purchaseCounts, orderItems] = await Promise.all([\n      prisma.interactionLog.groupBy({\n        by: [\"action\"],\n        where: {\n          productId: { in: productIds },\n          action: {\n            in: [\"CLICK\", \"ADD_TO_CART\", \"PURCHASE\"],\n          },\n        },\n        _count: { _all: true },\n      }),\n      prisma.interactionLog.groupBy({\n        by: [\"productId\"],\n        where: {\n          productId: { in: productIds },\n          action: \"PURCHASE\",\n        },\n        _count: { _all: true },\n      }),\n      prisma.orderItem.findMany({\n        where: { productId: { in: productIds } },\n        select: {\n          productId: true,\n          price: true,\n          quantity: true,\n        },\n      }),\n    ]);\n\n    let totalClicks = 0;\n    let totalCartAdds = 0;\n    let totalPurchases = 0;\n\n    for (const row of interactionCounts) {\n      if (row.action === \"CLICK\") {\n        totalClicks = row._count._all;\n      } else if (row.action === \"ADD_TO_CART\") {\n        totalCartAdds = row._count._all;\n      } else if (row.action === \"PURCHASE\") {\n        totalPurchases = row._count._all;\n      }\n    }\n\n    const totalRevenue = orderItems.reduce(\n      (sum, item) => sum + item.price * item.quantity,\n      0\n    );\n\n    const productNameById = new Map<number, string>(\n      products.map((product) => [product.id, product.name])\n    );\n\n    const topProducts: TopProduct[] = purchaseCounts\n      .map((row) => ({\n        id: row.productId,\n        name: productNameById.get(row.productId) ?? \"Unknown Product\",\n        totalPurchases: row._count._all,\n      }))\n      .sort((a, b) => b.totalPurchases - a.totalPurchases);\n\n    const response: VendorAnalyticsResponse = {\n      totalProducts,\n      totalClicks,\n      totalCartAdds,\n      totalPurchases,\n      totalRevenue,\n      topProducts,\n      categorySales: buildCategorySales(orderItems, productNameById),\n    };\n\n    return NextResponse.json(response, { status: 200 });\n  } catch {\n    return NextResponse.json(\n      { message: \"Failed to fetch vendor analytics\" },\n      { status: 500 }\n    );\n  }\n}\n\nfunction buildCategorySales(\n  orderItems: Array<{ productId: number; price: number; quantity: number }>,\n  productNameById: Map<number, string>\n): CategorySales[] {\n  const categoryMap = new Map<string, CategorySales>();\n\n  for (const item of orderItems) {\n    const productName = productNameById.get(item.productId) ?? \"\";\n    const category = deriveCategory(productName);\n    const current = categoryMap.get(category) ?? {\n      category,\n      revenue: 0,\n      unitsSold: 0,\n      orders: 0,\n    };\n\n    current.revenue += item.price * item.quantity;\n    current.unitsSold += item.quantity;\n    current.orders += 1;\n    categoryMap.set(category, current);\n  }\n\n  return Array.from(categoryMap.values())\n    .map((entry) => ({\n      ...entry,\n      revenue: Number(entry.revenue.toFixed(2)),\n    }))\n    .sort((a, b) => b.revenue - a.revenue);\n}\n"],"names":[],"mappings":"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"}}]
}