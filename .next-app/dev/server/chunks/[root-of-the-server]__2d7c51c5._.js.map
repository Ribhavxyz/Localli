{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Ribhav/OneDrive/Documents/Projects/Major%20project%20final/localli/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\r\n\r\nconst globalForPrisma = global as unknown as { prisma: PrismaClient };\r\n\r\nexport const prisma =\r\n  globalForPrisma.prisma ||\r\n  new PrismaClient({\r\n    log: [\"query\"],\r\n  });\r\n\r\nif (process.env.NODE_ENV !== \"production\")\r\n  globalForPrisma.prisma = prisma;\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AAEC,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,sMAAY,CAAC;IACf,KAAK;QAAC;KAAQ;AAChB;AAEF,wCACE,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 87, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Ribhav/OneDrive/Documents/Projects/Major%20project%20final/localli/src/lib/api.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\n\nexport function jsonError(message: string, status: number) {\n  return NextResponse.json({ error: message }, { status });\n}\n\n"],"names":[],"mappings":";;;;AAAA;;AAEO,SAAS,UAAU,OAAe,EAAE,MAAc;IACvD,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAAQ,GAAG;QAAE;IAAO;AACxD"}},
    {"offset": {"line": 104, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Ribhav/OneDrive/Documents/Projects/Major%20project%20final/localli/src/lib/auth.ts"],"sourcesContent":["import { Role } from \"@prisma/client\";\nimport { NextRequest, NextResponse } from \"next/server\";\nimport jwt, { JwtPayload } from \"jsonwebtoken\";\nimport { jsonError } from \"@/lib/api\";\n\ntype AuthPayload = {\n  userId: number;\n  role: Role;\n};\n\nexport function signToken(payload: AuthPayload) {\n  const jwtSecret = process.env.JWT_SECRET;\n  if (!jwtSecret) {\n    throw new Error(\"JWT_SECRET is required\");\n  }\n\n  return jwt.sign(payload, jwtSecret, { expiresIn: \"7d\" });\n}\n\nfunction getJwtSecret() {\n  return process.env.JWT_SECRET ?? null;\n}\n\nfunction verifyToken(token: string): AuthPayload | null {\n  const jwtSecret = getJwtSecret();\n  if (!jwtSecret) {\n    return null;\n  }\n\n  try {\n    const decoded = jwt.verify(token, jwtSecret) as JwtPayload & Partial<AuthPayload>;\n    if (\n      typeof decoded.userId !== \"number\" ||\n      (decoded.role !== \"CUSTOMER\" && decoded.role !== \"VENDOR\" && decoded.role !== \"ADMIN\")\n    ) {\n      return null;\n    }\n\n    return {\n      userId: decoded.userId,\n      role: decoded.role,\n    };\n  } catch {\n    return null;\n  }\n}\n\nexport function getAuthContext(\n  request: NextRequest\n): { auth: AuthPayload; error: null } | { auth: null; error: NextResponse } {\n  const header = request.headers.get(\"authorization\");\n\n  if (!header || !header.startsWith(\"Bearer \")) {\n    return { auth: null, error: jsonError(\"Unauthorized\", 401) };\n  }\n\n  const token = header.slice(\"Bearer \".length).trim();\n  const auth = verifyToken(token);\n\n  if (!auth) {\n    return { auth: null, error: jsonError(\"Invalid token\", 401) };\n  }\n\n  return { auth, error: null };\n}\n\nexport function requireRole(auth: AuthPayload, role: Role): NextResponse | null {\n  if (auth.role !== role) {\n    return jsonError(\"Forbidden\", 403);\n  }\n\n  return null;\n}\n\nexport function requireAnyRole(auth: AuthPayload, roles: Role[]): NextResponse | null {\n  if (!roles.includes(auth.role)) {\n    return jsonError(\"Forbidden\", 403);\n  }\n\n  return null;\n}\n\nexport type { AuthPayload };\n"],"names":[],"mappings":";;;;;;;;;;AAEA;AACA;;;AAOO,SAAS,UAAU,OAAoB;IAC5C,MAAM,YAAY,QAAQ,GAAG,CAAC,UAAU;IACxC,IAAI,CAAC,WAAW;QACd,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO,kJAAG,CAAC,IAAI,CAAC,SAAS,WAAW;QAAE,WAAW;IAAK;AACxD;AAEA,SAAS;IACP,OAAO,QAAQ,GAAG,CAAC,UAAU,IAAI;AACnC;AAEA,SAAS,YAAY,KAAa;IAChC,MAAM,YAAY;IAClB,IAAI,CAAC,WAAW;QACd,OAAO;IACT;IAEA,IAAI;QACF,MAAM,UAAU,kJAAG,CAAC,MAAM,CAAC,OAAO;QAClC,IACE,OAAO,QAAQ,MAAM,KAAK,YACzB,QAAQ,IAAI,KAAK,cAAc,QAAQ,IAAI,KAAK,YAAY,QAAQ,IAAI,KAAK,SAC9E;YACA,OAAO;QACT;QAEA,OAAO;YACL,QAAQ,QAAQ,MAAM;YACtB,MAAM,QAAQ,IAAI;QACpB;IACF,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,SAAS,eACd,OAAoB;IAEpB,MAAM,SAAS,QAAQ,OAAO,CAAC,GAAG,CAAC;IAEnC,IAAI,CAAC,UAAU,CAAC,OAAO,UAAU,CAAC,YAAY;QAC5C,OAAO;YAAE,MAAM;YAAM,OAAO,IAAA,gIAAS,EAAC,gBAAgB;QAAK;IAC7D;IAEA,MAAM,QAAQ,OAAO,KAAK,CAAC,UAAU,MAAM,EAAE,IAAI;IACjD,MAAM,OAAO,YAAY;IAEzB,IAAI,CAAC,MAAM;QACT,OAAO;YAAE,MAAM;YAAM,OAAO,IAAA,gIAAS,EAAC,iBAAiB;QAAK;IAC9D;IAEA,OAAO;QAAE;QAAM,OAAO;IAAK;AAC7B;AAEO,SAAS,YAAY,IAAiB,EAAE,IAAU;IACvD,IAAI,KAAK,IAAI,KAAK,MAAM;QACtB,OAAO,IAAA,gIAAS,EAAC,aAAa;IAChC;IAEA,OAAO;AACT;AAEO,SAAS,eAAe,IAAiB,EAAE,KAAa;IAC7D,IAAI,CAAC,MAAM,QAAQ,CAAC,KAAK,IAAI,GAAG;QAC9B,OAAO,IAAA,gIAAS,EAAC,aAAa;IAChC;IAEA,OAAO;AACT"}},
    {"offset": {"line": 185, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Ribhav/OneDrive/Documents/Projects/Major%20project%20final/localli/src/app/api/cart/%5Bid%5D/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { prisma } from \"@/lib/prisma\";\nimport { getAuthContext, requireRole } from \"@/lib/auth\";\n\ntype Params = {\n  params: Promise<{ id: string }>;\n};\n\ntype UpdateBody = {\n  quantity: number;\n};\n\nfunction isUpdateBody(value: unknown): value is UpdateBody {\n  if (typeof value !== \"object\" || value === null) {\n    return false;\n  }\n\n  const body = value as Record<string, unknown>;\n  return typeof body.quantity === \"number\" && Number.isInteger(body.quantity);\n}\n\nexport async function PATCH(request: NextRequest, { params }: Params) {\n  const { auth, error } = getAuthContext(request);\n  if (error) {\n    return error;\n  }\n\n  const roleError = requireRole(auth, \"CUSTOMER\");\n  if (roleError) {\n    return roleError;\n  }\n\n  const { id } = await params;\n  const cartItemId = Number(id);\n  if (!Number.isInteger(cartItemId)) {\n    return NextResponse.json({ message: \"Invalid cart item id\" }, { status: 400 });\n  }\n\n  try {\n    const body: unknown = await request.json();\n    if (!isUpdateBody(body)) {\n      return NextResponse.json(\n        { message: \"Invalid body. Required: { quantity: number }\" },\n        { status: 400 }\n      );\n    }\n\n    if (body.quantity <= 0) {\n      return NextResponse.json(\n        { message: \"quantity must be greater than 0\" },\n        { status: 400 }\n      );\n    }\n\n    const cartItem = await prisma.cartItem.findFirst({\n      where: {\n        id: cartItemId,\n        userId: auth.userId,\n      },\n      select: {\n        id: true,\n        productId: true,\n      },\n    });\n\n    if (!cartItem) {\n      return NextResponse.json({ message: \"Cart item not found\" }, { status: 404 });\n    }\n\n    const product = await prisma.product.findUnique({\n      where: { id: cartItem.productId },\n      select: { stock: true },\n    });\n\n    if (!product) {\n      return NextResponse.json({ message: \"Product not found\" }, { status: 404 });\n    }\n\n    if (body.quantity > product.stock) {\n      return NextResponse.json(\n        { message: \"Requested quantity exceeds available stock\" },\n        { status: 409 }\n      );\n    }\n\n    const updatedCartItem = await prisma.cartItem.update({\n      where: { id: cartItem.id },\n      data: { quantity: body.quantity },\n    });\n\n    return NextResponse.json(updatedCartItem, { status: 200 });\n  } catch {\n    return NextResponse.json({ message: \"Invalid request body\" }, { status: 400 });\n  }\n}\n\nexport async function DELETE(request: NextRequest, { params }: Params) {\n  const { auth, error } = getAuthContext(request);\n  if (error) {\n    return error;\n  }\n\n  const roleError = requireRole(auth, \"CUSTOMER\");\n  if (roleError) {\n    return roleError;\n  }\n\n  const { id } = await params;\n  const cartItemId = Number(id);\n  if (!Number.isInteger(cartItemId)) {\n    return NextResponse.json({ message: \"Invalid cart item id\" }, { status: 400 });\n  }\n\n  const cartItem = await prisma.cartItem.findFirst({\n    where: {\n      id: cartItemId,\n      userId: auth.userId,\n    },\n    select: { id: true },\n  });\n\n  if (!cartItem) {\n    return NextResponse.json({ message: \"Cart item not found\" }, { status: 404 });\n  }\n\n  await prisma.cartItem.delete({\n    where: { id: cartItem.id },\n  });\n\n  return NextResponse.json({ message: \"Cart item removed successfully\" }, { status: 200 });\n}\n"],"names":[],"mappings":"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"}}]
}