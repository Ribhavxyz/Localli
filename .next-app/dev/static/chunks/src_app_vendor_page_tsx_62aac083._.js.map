{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Ribhav/OneDrive/Documents/Projects/Major%20project%20final/localli/src/app/vendor/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useMemo, useState } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport { authFetch } from \"@/lib/authFetch\";\nimport {\n  Line,\n  LineChart,\n  ResponsiveContainer,\n  Tooltip,\n  XAxis,\n  YAxis,\n} from \"recharts\";\n\ntype AnalyticsResponse = {\n  totalProducts: number;\n  totalClicks: number;\n  totalCartAdds: number;\n  totalPurchases: number;\n  totalRevenue: number;\n};\n\ntype VendorOrder = {\n  id: number;\n  total: number;\n  status: string;\n  createdAt: string;\n  orderItems: Array<{ id: number; productId: number; quantity: number; price: number }>;\n};\n\nexport default function VendorDashboardPage() {\n  const router = useRouter();\n  const [analytics, setAnalytics] = useState<AnalyticsResponse | null>(null);\n  const [orders, setOrders] = useState<VendorOrder[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    let active = true;\n\n    async function loadData() {\n      try {\n        setLoading(true);\n        setError(null);\n\n        const [storeRes, analyticsRes, ordersRes] = await Promise.all([\n          authFetch(\"/api/vendor/store\"),\n          authFetch(\"/api/vendor/analytics\"),\n          authFetch(\"/api/vendor/orders\"),\n        ]);\n\n        if (storeRes.status === 404) {\n          router.replace(\"/vendor/store\");\n          return;\n        }\n\n        if (!storeRes.ok || !analyticsRes.ok || !ordersRes.ok) {\n          throw new Error(\"Failed to load vendor dashboard\");\n        }\n\n        const analyticsData = (await analyticsRes.json()) as AnalyticsResponse;\n        const ordersData = (await ordersRes.json()) as VendorOrder[];\n        if (!active) {\n          return;\n        }\n\n        setAnalytics(analyticsData);\n        setOrders(Array.isArray(ordersData) ? ordersData : []);\n      } catch (err) {\n        if (!active) {\n          return;\n        }\n        setError(err instanceof Error ? err.message : \"Unable to load dashboard\");\n      } finally {\n        if (active) {\n          setLoading(false);\n        }\n      }\n    }\n\n    void loadData();\n    return () => {\n      active = false;\n    };\n  }, [router]);\n\n  const weeklyRevenueData = useMemo(() => buildWeeklyRevenueData(orders), [orders]);\n\n  if (loading) {\n    return (\n      <div className=\"rounded-2xl border border-zinc-800 bg-zinc-900/80 p-10 text-center text-zinc-300\">\n        Loading dashboard...\n      </div>\n    );\n  }\n\n  if (error || !analytics) {\n    return (\n      <div className=\"rounded-2xl border border-red-900/40 bg-red-950/20 p-6 text-red-300\">\n        {error ?? \"Failed to load dashboard\"}\n      </div>\n    );\n  }\n\n  const avgOrderValue =\n    analytics.totalPurchases > 0 ? analytics.totalRevenue / analytics.totalPurchases : 0;\n\n  return (\n    <div className=\"space-y-8\">\n      <h1 className=\"text-5xl font-bold tracking-tight md:text-6xl\">Vendor Dashboard</h1>\n\n      <section className=\"grid grid-cols-1 gap-6 md:grid-cols-2 xl:grid-cols-4\">\n        <MetricCard label=\"Total Products\" value={analytics.totalProducts.toString()} tone=\"blue\" note=\"+4 this week\" />\n        <MetricCard label=\"Total Orders\" value={analytics.totalPurchases.toString()} tone=\"green\" note=\"+12% vs last week\" />\n        <MetricCard label=\"Revenue\" value={`$${analytics.totalRevenue.toLocaleString(undefined, { maximumFractionDigits: 0 })}`} tone=\"amber\" note=\"+18% vs last week\" />\n        <MetricCard label=\"Avg Order Value\" value={`$${avgOrderValue.toFixed(2)}`} tone=\"purple\" note=\"+5% increase\" />\n      </section>\n\n      <section className=\"grid grid-cols-1 gap-6 xl:grid-cols-[2fr_1fr]\">\n        <div className=\"rounded-2xl border border-zinc-800 bg-zinc-900/90 p-6\">\n          <h2 className=\"text-4xl font-semibold\">Weekly Revenue</h2>\n          <div className=\"mt-5 h-[380px]\">\n            <ResponsiveContainer height=\"100%\" width=\"100%\">\n              <LineChart data={weeklyRevenueData} margin={{ top: 10, right: 16, left: 0, bottom: 10 }}>\n                <XAxis\n                  axisLine={{ stroke: \"#3F3F46\" }}\n                  dataKey=\"label\"\n                  tick={{ fill: \"#A1A1AA\", fontSize: 12 }}\n                  tickLine={false}\n                />\n                <YAxis\n                  axisLine={{ stroke: \"#3F3F46\" }}\n                  tick={{ fill: \"#A1A1AA\", fontSize: 12 }}\n                  tickLine={false}\n                  width={48}\n                />\n                <Tooltip\n                  contentStyle={{\n                    backgroundColor: \"#1C1C1E\",\n                    border: \"1px solid #3F3F46\",\n                    borderRadius: \"12px\",\n                    color: \"#FFFFFF\",\n                  }}\n                  formatter={(value: number | string | undefined) => {\n                    const numeric = typeof value === \"number\" ? value : Number(value ?? 0);\n                    return [`$${numeric.toFixed(2)}`, \"Revenue\"];\n                  }}\n                  labelStyle={{ color: \"#FFFFFF\" }}\n                />\n                <Line\n                  dataKey=\"revenue\"\n                  dot={{ fill: \"#4F7CFF\", r: 5, strokeWidth: 0 }}\n                  stroke=\"#4F7CFF\"\n                  strokeWidth={4}\n                  type=\"monotone\"\n                />\n              </LineChart>\n            </ResponsiveContainer>\n          </div>\n        </div>\n\n        <div className=\"rounded-2xl border border-zinc-800 bg-zinc-900/90 p-6\">\n          <h2 className=\"text-4xl font-semibold\">Recent Orders</h2>\n          <div className=\"mt-5 space-y-4\">\n            {orders.length === 0 ? (\n              <p className=\"text-zinc-400\">No recent orders.</p>\n            ) : (\n              orders.slice(0, 5).map((order) => (\n                <div className=\"border-b border-zinc-800 pb-4 last:border-b-0\" key={order.id}>\n                  <div className=\"flex items-center justify-between gap-3\">\n                    <p className=\"text-3xl font-semibold\">ORD-{order.id}</p>\n                    <span className={`rounded-xl px-3 py-1 text-lg ${statusStyle(order.status)}`}>\n                      {order.status.toLowerCase()}\n                    </span>\n                  </div>\n                  <p className=\"mt-1 text-xl text-zinc-400\">\n                    {new Date(order.createdAt).toLocaleDateString()}\n                  </p>\n                  <p className=\"mt-2 text-3xl font-semibold\">${order.total.toFixed(2)}</p>\n                </div>\n              ))\n            )}\n          </div>\n        </div>\n      </section>\n    </div>\n  );\n}\n\nfunction MetricCard({\n  label,\n  value,\n  note,\n  tone,\n}: {\n  label: string;\n  value: string;\n  note: string;\n  tone: \"blue\" | \"green\" | \"amber\" | \"purple\";\n}) {\n  const colorMap: Record<\"blue\" | \"green\" | \"amber\" | \"purple\", string> = {\n    blue: \"text-blue-400\",\n    green: \"text-emerald-400\",\n    amber: \"text-amber-400\",\n    purple: \"text-violet-400\",\n  };\n\n  return (\n    <article className=\"rounded-2xl border border-zinc-800 bg-zinc-900/90 p-6\">\n      <p className=\"text-2xl text-zinc-400\">{label}</p>\n      <p className={`mt-4 text-6xl font-bold ${colorMap[tone]}`}>{value}</p>\n      <p className=\"mt-2 text-lg text-[#30D158]\">{note}</p>\n    </article>\n  );\n}\n\nfunction statusStyle(status: string): string {\n  const normalized = status.toLowerCase();\n  if (normalized.includes(\"completed\")) return \"bg-emerald-950/60 text-emerald-300\";\n  if (normalized.includes(\"process\") || normalized.includes(\"placed\"))\n    return \"bg-amber-950/60 text-amber-300\";\n  if (normalized.includes(\"transit\")) return \"bg-violet-950/60 text-violet-300\";\n  return \"bg-blue-950/60 text-blue-300\";\n}\n\nfunction buildWeeklyRevenueData(orders: VendorOrder[]): Array<{ label: string; revenue: number }> {\n  const now = new Date();\n  const start = new Date(now);\n  start.setHours(0, 0, 0, 0);\n  start.setDate(start.getDate() - 6);\n\n  const buckets = new Map<string, number>();\n  for (let i = 0; i < 7; i += 1) {\n    const day = new Date(start);\n    day.setDate(start.getDate() + i);\n    const key = day.toISOString().slice(0, 10);\n    buckets.set(key, 0);\n  }\n\n  for (const order of orders) {\n    const created = new Date(order.createdAt);\n    if (Number.isNaN(created.getTime())) {\n      continue;\n    }\n\n    created.setHours(0, 0, 0, 0);\n    const key = created.toISOString().slice(0, 10);\n    if (!buckets.has(key)) {\n      continue;\n    }\n    buckets.set(key, (buckets.get(key) ?? 0) + order.total);\n  }\n\n  return Array.from(buckets.entries()).map(([key, revenue]) => ({\n    label: new Date(key).toLocaleDateString(undefined, { weekday: \"short\" }),\n    revenue: Number(revenue.toFixed(2)),\n  }));\n}\n"],"names":[],"mappings":"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"}}]
}